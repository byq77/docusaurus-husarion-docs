<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Using CORE2 with Mbed OS · Husarion Docs</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;introduction&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#introduction&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Introduction&lt;/h2&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Using CORE2 with Mbed OS · Husarion Docs"/><meta property="og:type" content="website"/><meta property="og:url" content="https://byq77.github.io/docusaurus-husarion-docs/index.html"/><meta property="og:description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;introduction&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#introduction&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Introduction&lt;/h2&gt;
"/><meta property="og:image" content="https://byq77.github.io/docusaurus-husarion-docs/img/favicon.ico"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://byq77.github.io/docusaurus-husarion-docs/img/favicon.ico"/><link rel="shortcut icon" href="/docusaurus-husarion-docs/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://byq77.github.io/docusaurus-husarion-docs/blog/atom.xml" title="Husarion Docs Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://byq77.github.io/docusaurus-husarion-docs/blog/feed.xml" title="Husarion Docs Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="js/scrollspy.js"></script><script type="text/javascript" src="js/sidebarScroll.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100,"diameter":56,"cornerOffset":20,"backgroundColor":"#d0112b","textColor":"#fff"}
          )
        });
        </script><link rel="stylesheet" href="/docusaurus-husarion-docs/css/prism.css"/><link rel="stylesheet" href="/docusaurus-husarion-docs/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/docusaurus-husarion-docs/"><img class="logo" src="/docusaurus-husarion-docs/img/husarion_logo_white.svg" alt="Husarion Docs"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docusaurus-husarion-docs/tutorials/" target="_self">Tutorials</a></li><li class=""><a href="/docusaurus-husarion-docs/doc4" target="_self">Manuals</a></li><li class=""><a href="/docusaurus-husarion-docs/doc4" target="_self">Software</a></li><li class=""><a href="/docusaurus-husarion-docs/help" target="_self">Help</a></li><li class=""><a href="/docusaurus-husarion-docs/blog/" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Tutorials</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorials</h3><ul><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/tutorials/">About tutorials</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">How to start</h4><ul><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/tutorials/howtostart/run-your-first-program">Run your first program</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/tutorials/howtostart/video-streaming-from-a-camera">Video streaming from a camera</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/tutorials/howtostart/getting-started-with-husarion--lego-mindstorms">Getting started with Husarion + LEGO Mindstorms</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">ROS tutorials</h4><ul><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/doc2">document number 2</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Mbed tutorials</h4><ul><li class="navListItem navListItemActive"><a class="navItem" href="/docusaurus-husarion-docs/tutorials/mbed-tutorials/using-core2-with-mbed-os">Using CORE2 with Mbed OS</a></li></ul></div></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Using CORE2 with Mbed OS</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="introduction"></a><a href="#introduction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p><strong>Mbed OS</strong> is free, open-source platform and embedded operating system designed for IoT devices based on Arm Cortex-M family of microcontrollers. It is developed as collaborative project by <em>Arm</em>, its partners and growing community of individual devs from across the world. Mbed OS is distributed under the <a href="https://en.wikipedia.org/wiki/Apache_License">Apache-2.0 License</a> and it's available on project's <a href="https://github.com/ARMmbed/mbed-os">GitHub page</a>.</p>
<p>Besides support for variety of boards from different manufacturers the framework has features like:</p>
<ul>
<li>built-in support for connectivity options like <em>Bluetooth LE</em>, <em>Wi-Fi</em>, <em>Ethernet</em>, <em>Cellular</em>, <em>LoRa LPWAN</em>, <em>NFC</em> and others,</li>
<li>RTOS core based on open-source <em>CMSIS-RTOS RTX</em>,</li>
<li><em>Hardware Enforced Security</em> and <em>Communications Security</em>,</li>
<li>easy and portable API.</li>
</ul>
<p>
<img src="./../../assets/img/mbed-tutorials/logo.png" width="400px" alt="Mbed OS logo"/>
</p>
<ul>
<li><a href="https://www.mbed.com/en/platform/mbed-os/">Official Webpage</a></li>
<li><a href="https://os.mbed.com/docs/v5.10/">Mbed OS documentation</a></li>
<li><a href="https://os.mbed.com/docs/v5.10/mbed-os-api-doxy/modules.html">Mbed OS Doxygen API</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="first-steps"></a><a href="#first-steps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>First Steps</h2>
<p>In this tutorial we will show you how to build, compile and run mbed applications on <strong>CORE2</strong> using mbed offline tools. You will be introduced to basics of mbed API, learn how to use rosserial library to connect your mbed application with SBC and more. Let's hack!</p>
<p>
<center>
<img src="https://cdn.shopify.com/s/files/1/2545/8446/products/CORE2-ROS_1024x1024@2x.png?v=1520001976" width="400px" alt="Mbed OS logo"/>
</center>
</p>
<h3><a class="anchor" aria-hidden="true" id="prerequisites"></a><a href="#prerequisites" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites</h3>
<h4><a class="anchor" aria-hidden="true" id="hardware"></a><a href="#hardware" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hardware</h4>
<ul>
<li>CORE2-ROS (with SBC) or CORE2 and computer running Linux with ROS Kinetic,</li>
<li><em>ST-LINK V2 programmer</em> to flash CORE2 with mbed firmware,</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="software"></a><a href="#software" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Software</h4>
<p>Before we start make sure you have following tools installed on your system:</p>
<ul>
<li><a href="https://code.visualstudio.com/">Visual Studio Code IDE</a></li>
<li><a href="https://developer.arm.com/open-source/gnu-toolchain/gnu-rm/downloads">GNU Arm Embedded version 6 toolchain</a></li>
<li><a href="https://www.st.com/en/development-tools/stsw-link004.html">STM32 ST-LINK Utility</a> (Windows only)</li>
<li><a href="https://github.com/texane/stlink/blob/master/README.md">stlink flasher</a> (Mac or Linux)</li>
</ul>
<p>You can check our tutorial: <a href="https://husarion.com/core2/tutorials/other-tutorials/offline-development-tools">2. Offline development tools</a> to find information on stlink flasher and VS Code IDE installation and configuration.</p>
<p>Everything up and ready? Proceed to the next step then.</p>
<h3><a class="anchor" aria-hidden="true" id="mbed-cli-installation"></a><a href="#mbed-cli-installation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>mbed-cli installation</h3>
<p><code>mbed-cli</code> is a package name of <strong>Arm Mbed CLI</strong>, a command-line tool that enables use of Mbed build system, GIT/Mercurial-based version control, dependencies management and more. Check <a href="https://github.com/ARMmbed/mbed-cli">Mbed CLI GitHub page</a> or <a href="https://os.mbed.com/docs/v5.10/tools/developing-mbed-cli.html">Mbed documentation</a> for details about the tool.</p>
<p>To install <code>mbed-cli</code> follow <a href="https://os.mbed.com/docs/v5.10/tools/installation-and-setup.html">this</a> tutorial from the Mbed documentation.</p>
<p>Installers for both Windows and macOS are provided. Linux users have to install tool manually. In case you are user of the latter system check if you have both Git and Mercurial installed before you start. See <a href="https://os.mbed.com/docs/v5.10/tools/requirements.html">Requirements</a> page for more details.</p>
<p>To check if installation was successful open terminal and run:</p>
<pre><code class="hljs css language-bash">    $ mbed --version
    1.8.3
</code></pre>
<p>After installation you have to inform Mbed CLI about location of compiler (in our case GCC Arm Embedded Compiler) binaries. We will use global setting. Run:</p>
<pre><code class="hljs css language-bash">    $ mbed config -G GCC_ARM_PATH &lt;path to compiler&gt;
</code></pre>
<p>Linux example:</p>
<pre><code class="hljs css language-bash">    $ mbed config -G GCC_ARM_PATH /home/szysza/opt/gcc-arm-none-eabi-6-2017-q2-update/bin
</code></pre>
<p>Windows example:</p>
<pre><code class="hljs css language-bash">    $ <span class="hljs-built_in">where</span> arm-none-eabi-gcc <span class="hljs-comment"># prints path to arm-none-eabi-gcc.exe if in PATH</span>
    $ mbed config -G GCC_ARM_PATH <span class="hljs-string">"C:\Program Files (x86)\GNU Tools ARM Embedded\6 2017-q2-update\bin"</span>
</code></pre>
<p>You can check current configuration by running:</p>
<pre><code class="hljs">    $ mbed<span class="hljs-built_in"> config </span>--list
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="preparing-a-workspace"></a><a href="#preparing-a-workspace" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Preparing a workspace</h3>
<p>Create a new folder <code>core2-mbed-workspace</code>. It will serve as workspace for your mbed projects. Run:</p>
<pre><code class="hljs css language-bash">    $ mkdir core2-mbed-workspace &amp;&amp; <span class="hljs-built_in">cd</span> core2-mbed-workspace
</code></pre>
<p>Next step is to import <code>mbed-os</code> library. It will be used by all your projects. In your workspace folder run:</p>
<pre><code class="hljs">    $ mbed <span class="hljs-keyword">import</span> mbed-os
    [mbed] Working <span class="hljs-type">path</span> "E:\mbed_projects\core2-mbed-workspace" (directory)
    [mbed] Program <span class="hljs-type">path</span> "E:\mbed_projects\core2-mbed-workspace"
    [mbed] Importing program "mbed-os" <span class="hljs-keyword">from</span> "https://github.com/ARMmbed/mbed-os" at latest revision <span class="hljs-keyword">in</span> the <span class="hljs-keyword">current</span> branch
</code></pre>
<p>Mbed CLI needs to know the path to <code>mbed-os</code> directory. This way all your projects can use one instance of library (default configuration is to have separate instance of library for each project). Run:</p>
<pre><code class="hljs">    $ mbed<span class="hljs-built_in"> config </span>-G MBED_OS_DIR &lt;path <span class="hljs-keyword">to</span> mbed-os&gt;
</code></pre>
<p>Example:</p>
<pre><code class="hljs">    $ mbed<span class="hljs-built_in"> config </span>-G MBED_OS_DIR <span class="hljs-string">"E:\mbed_projects\core2-mbed-workspace\mbed-os"</span>
    [mbed] Working path <span class="hljs-string">"E:\mbed_projects\core2-mbed-workspace"</span> (directory)
    [mbed] Program path <span class="hljs-string">"E:\mbed_projects\core2-mbed-workspace"</span>
    [mbed] E:\mbed_projects\core2-mbed-workspace\mbed-os now <span class="hljs-builtin-name">set</span> as global MBED_OS_DIR
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="adding-mbedignore-"></a><a href="#adding-mbedignore-" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding .mbedignore</h4>
<p>In order to add support for CORE2 target and speed-up building of your projects we will exclude certain folders of <code>mbed-os</code> library from compilation. For this purpose Mbed build system provides <code>.mbedignore</code> files. They have similar structure to <code>.gitignore</code> files used by GIT.</p>
<p>In your local <code>mbed-os</code> library directory create a new file and name it <code>.mbedignore</code>. Open it and add following lines:</p>
<pre><code class="hljs">features<span class="hljs-regexp">/cellular/</span>*
features<span class="hljs-regexp">/cryptocell/</span>*
features<span class="hljs-regexp">/deprecated_warnings/</span>*
features<span class="hljs-regexp">/device_key/</span>*
features<span class="hljs-regexp">/lorawan/</span>*
features<span class="hljs-regexp">/lwipstack/</span>*
features<span class="hljs-regexp">/nanostack/</span>*
features<span class="hljs-regexp">/netsocket/</span>*
features<span class="hljs-regexp">/nfc/</span>*
features<span class="hljs-regexp">/unsupported/</span>*
features<span class="hljs-regexp">/storage/</span>*
components<span class="hljs-regexp">/wifi/</span>*
components<span class="hljs-regexp">/802.15.4_RF/</span>*
components<span class="hljs-regexp">/storage/</span>*
targets<span class="hljs-regexp">/TARGET_STM/</span>TARGET_STM32F4<span class="hljs-regexp">/TARGET_STM32F407xG/</span>device<span class="hljs-regexp">/TOOLCHAIN_GCC_ARM/</span>STM32F407XG.ld
targets<span class="hljs-regexp">/TARGET_STM/</span>TARGET_STM32F4<span class="hljs-regexp">/TARGET_STM32F407xG/</span>device<span class="hljs-regexp">/TOOLCHAIN_GCC_ARM/</span>startup_stm32f407xx.S
</code></pre>
<p>Only two last entries are necessary. You can learn more about ignoring files <a href="https://os.mbed.com/docs/v5.10/tools/ignoring-files-from-mbed-build.html">here</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="template-project"></a><a href="#template-project" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Template Project</h3>
<p>We will start by setting up a template project. You can use it as starting point for all of your mbed applications.</p>
<p>Just download the zip : <a href="https://github.com/husarion/core2-mbed-template/archive/master.zip">https://github.com/husarion/core2-mbed-template/archive/master.zip</a> and extract it in your workspace.</p>
<p>On Linux:</p>
<pre><code class="hljs css language-bash">    $ wget https://github.com/husarion/core2-mbed-template/archive/master.zip &amp;&amp; unzip master.zip
</code></pre>
<p>You can also clone the repository using GIT:</p>
<pre><code class="hljs css language-bash">    $ git <span class="hljs-built_in">clone</span> https://github.com/husarion/core2-mbed-template.git
</code></pre>
<p>Open the directory in Visual Studio Code. In file <code>setting.json</code> from directory <code>.vscode</code> change the value of <code>C_cpp.default.compilerPath</code> to match location of <code>arm-none-eabi-gcc</code> on your system:</p>
<div>
<center><img src="./../../assets/img/mbed-tutorials/mbed-tutorial-img2.png" width="800px" alt=""/></center>
</div> 
<p>This setting enables more accurate IntelliSense feature in editor.</p>
<h4><a class="anchor" aria-hidden="true" id="template-files"></a><a href="#template-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Template files</h4>
<p>Open the template directory and select <code>src/main.cpp</code>. You should see:</p>
<div>
<center><img src="./../../assets/img/mbed-tutorials/mbed-tutorial-img1.png" width="800px" alt=""/></center>
</div> 
<p>As you no doubt have guessed this simple code just lights up three on-board LEDs in particular sequence. We instantiate <code>BusOut</code> object that allows to control multiple digital pins at the same time regardless of ports they're assigned to. On-board LEDs blink in order described by <code>leds_mask</code> array at the interval introduced by function <code>ThisThread::sleep_for(1000)</code>.</p>
<p>In directory's root folder find <code>custom_targets.json</code> file:</p>
<div>
<center><img src="./../../assets/img/mbed-tutorials/mbed-tutorial-img3.png" width="800px" alt=""/></center>
</div> 
<p>Mbed OS Configuration system uses this file to add user's custom targets making it possible to run system on boards that aren't officially supported. We use <code>custom_targets.json</code> and files from <code>TARGET_CORE2</code> to define CORE2 target. You can learn more about configuration system <a href="https://os.mbed.com/docs/v5.10/reference/configuration.html">here</a>.</p>
<p>In folder <code>TARGET_CORE2</code> you can find files <code>PinNames.h</code> and <code>PeripheralPins.c</code>. First one defines pin names of mcu and the latter defines peripherals that can be used on each pin.</p>
<p>Another file that is used by Mbed OS configuration system is <code>mbed_app.json</code>. Open it.</p>
<div>
<center><img src="./../../assets/img/mbed-tutorials/mbed-tutorial-img4.png" width="800px" alt=""/></center>
</div> 
<p>In this file you can override default settings for application, define new configuration entries and create custom macros. In presented configuration :</p>
<ul>
<li>line <code>10</code> enables spawning a new thread for shared event queue,</li>
<li>lines <code>11</code> and <code>12</code> set default baudrate to 115200,</li>
<li>line <code>13</code> shifts the start of firmware in flash so it doesn't override bootloader.</li>
</ul>
<p>You can learn details of each settings from documentation.</p>
<p>The last file we will check is <code>task.json</code> from <code>.vscode</code> directory. It defines tasks that are recognized by Visual Studio Code IDE. They can be accessed by pressing <code>CTRL + SHIFT + P</code> and typing <code>Task: Run Task</code> in Command Pallete.</p>
<div>
<center><img src="./../../assets/img/mbed-tutorials/mbed-tutorial-img5.png" width="800px" alt=""/></center>
</div> 
<h4><a class="anchor" aria-hidden="true" id="building-and-flashing-firmware"></a><a href="#building-and-flashing-firmware" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Building and flashing firmware</h4>
<p>Press <code>CTRL + SHIFT + B</code>. It will run <code>CLEAN BUILD (RELEASE)</code> task. Wait until compilation finishes.</p>
<div>
<center><img src="./../../assets/img/mbed-tutorials/mbed-tutorial-img6.png" width="800px" alt=""/></center>
</div> 
<p>Connect your ST-LINK programmer to debug pins of CORE2 and make sure it's connected to your computer. Press <code>CTRL + SHIFT + P</code> and in Command Pallete type <code>Task: Run Task</code>. Select <code>FLASH FIRMWARE (RELEASE)</code>. The firmware flashing procedure should start:</p>
<div>
<center><img src="./../../assets/img/mbed-tutorials/mbed-tutorial-img7.png" width="800px" alt=""/></center>
</div> 
<p>If LEDs start blinking like on the animation below then congratulations! You've just successfully built and flashed your first Mbed application for CORE2!</p>
<div>
<center><img src="./../../assets/img/mbed-tutorials/mbed-tutorial-animation.gif" alt="result"/></center>
</div> 
<h4><a class="anchor" aria-hidden="true" id="tasks"></a><a href="#tasks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tasks</h4>
<ul>
<li>Modify existing application so as the on-board leds blink in Gray code.</li>
<li>Add <a href="https://os.mbed.com/docs/v5.10/apis/serial.html">Serial</a> to print current sequence to the stdout (micro-usb port on CORE2) at the same time.</li>
<li>In configuration files change baudrate to 9600.</li>
<li>Check target's files and learn which UART instance is connected to pins <code>USBTX</code> and <code>USBRX</code>.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="rosserial-library"></a><a href="#rosserial-library" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rosserial library</h2>
<p>If you made it this far you must be really into this stuff! Let's do something more interesting and learn how to communicate with devices running ROS using mbed. For this purpose we will use <a href="http://wiki.ros.org/rosserial_mbed">rosserial for mbed platforms</a>.</p>
<div>
<center><img src="./../../assets/img/mbed-tutorials/ros_logo.png" width="400px" alt="result"/></center>
</div> 
<h3><a class="anchor" aria-hidden="true" id="example-publisher"></a><a href="#example-publisher" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example publisher</h3>
<p>First we will create a new project directory. Just simply duplicate template project and name it <code>example-publisher</code>:</p>
<pre><code class="hljs css language-bash">    $ cp -rf core2-mbed-template example-publisher
</code></pre>
<p>Another way is to create empty mbed project using Mbed CLI. Just type:</p>
<pre><code class="hljs css language-bash">  $ mbed new &lt;project-name&gt; --program
</code></pre>
<p>After that copy content of template project except <code>.git</code> directory to your newly created program directory.</p>
<blockquote>
<p><strong>Tip</strong></p>
<p>If you cloned your template project from online repository and you don't want to have version control in it just delete <code>.git</code> directory:</p>
<pre><code class="hljs css language-bash">  $ rm -rf ./core2-mbed-template/.git/
</code></pre>
<p>You can add it latter by running <code>git init .</code> in root dir of your project.</p>
</blockquote>
<p>Open <code>example-publisher</code> directory in Visual Studio Code. In the program press <code>CTRL + ~</code> to open built-in terminal. In the terminal type:</p>
<pre><code class="hljs css language-bash">    $ <span class="hljs-built_in">cd</span> lib 
    $ mbed add https://github.com/byq77/rosserial-mbed
</code></pre>
<p>This will add <code>rosserial-mbed</code> library to your project and download all library's dependencies. Managing libraries this way is simple:</p>
<ul>
<li><code>mbed add &lt;library-url&gt;</code> - adds library to project,</li>
<li><code>mbed remove &lt;library-name&gt;</code> - removes library from project.</li>
</ul>
<div>
<center><img src="./../../assets/img/mbed-tutorials/mbed-tutorial-img8.png" width="800px" alt=""/></center>
</div> 
<h4><a class="anchor" aria-hidden="true" id="the-code"></a><a href="#the-code" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The code</h4>
<p>Take a minute to analyze the program below. We provided you with comments to make it easier.</p>
<pre><code class="hljs"><span class="hljs-comment">/*
 * main.cpp
 */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;mbed.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Thread.h&gt;</span></span>

<span class="hljs-comment">// This header file must be included before any other </span>
<span class="hljs-comment">// ros header files.</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ros.h&gt; </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;std_msgs/String.h&gt;</span></span>

<span class="hljs-comment">// DigitalOut objects for controlling on-board leds.</span>
DigitalOut led1(LED1,<span class="hljs-number">0</span>), led2(LED2,<span class="hljs-number">1</span>), ros_led(LED3,<span class="hljs-number">0</span>);

<span class="hljs-comment">// Thread object for controlling ros task. Feature of RTOS.</span>
Thread ros_thread;

<span class="hljs-comment">// Ticker object for controlling reoccurring interrupt </span>
<span class="hljs-comment">// that calls attached callback at given rate.  </span>
Ticker blinker;

<span class="hljs-comment">// Node handle instantiation - required for registering publishers, subscribers</span>
<span class="hljs-comment">// and handling serial communication.</span>
ros::NodeHandle  nh;

<span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * messages[] = {
    <span class="hljs-string">"mbed V5.10"</span>, <span class="hljs-string">"CORE2"</span>, <span class="hljs-string">"MCU"</span>, <span class="hljs-string">"STM32F407ZG"</span>, 
};

<span class="hljs-keyword">int</span> main()
{
    <span class="hljs-comment">// We use lambda style callback for registering a ros task</span>
    ros_thread.start([]()-&gt;<span class="hljs-keyword">void</span>{
        std_msgs::<span class="hljs-keyword">String</span> str_msg;
        
        <span class="hljs-comment">// Instantiate Publisher object with topic name "mbed device".</span>
        <span class="hljs-comment">// Second parameter is reference to instance of object that</span>
        <span class="hljs-comment">// will be used in communication.</span>
        ros::Publisher mbed_device(<span class="hljs-string">"mbed_device"</span>, &amp;str_msg);

        <span class="hljs-comment">// Initialize node and advertise our custom topic. </span>
        nh.initNode();
        nh.advertise(mbed_device);

        <span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>, n = <span class="hljs-keyword">sizeof</span>(messages)/<span class="hljs-keyword">sizeof</span>(messages[<span class="hljs-number">0</span>]);

        <span class="hljs-built_in">while</span>(<span class="hljs-number">1</span>)
        {
            ros_led = !ros_led;
            str_msg.data = messages[i%n];

            <span class="hljs-comment">// publish message to topic</span>
            mbed_device.publish(&amp;str_msg);
            i++;

            <span class="hljs-comment">// process all messages</span>
            nh.spinOnce();

            ThisThread::sleep_for(<span class="hljs-number">1000</span>);
        }
    });

    <span class="hljs-comment">// We attach lambda style callback to blink on-board leds</span>
    <span class="hljs-comment">// every 2 seconds.</span>
    blinker.<span class="hljs-built_in">attach</span>([]()-&gt;<span class="hljs-keyword">void</span>{
        led1 = !led1;
        led2 = !led2;
    },<span class="hljs-number">2.0</span>);
}
</code></pre>
<p>As you can see the program is pretty straightforward. It creates topic &quot;device_mbed&quot; and publishes messages to it blinking board's leds at the same time.</p>
<p>If you would like to know more about mbed specific code check <a href="https://os.mbed.com/docs/v5.10/apis/index.html">Mbed API</a> :</p>
<ul>
<li><a href="https://os.mbed.com/docs/v5.10/apis/thread.html">Thread</a>,</li>
<li><a href="https://os.mbed.com/docs/v5.10/apis/ticker.html">Ticker</a>,</li>
<li><a href="https://os.mbed.com/docs/v5.10/apis/digitalout.html">DigitalOut</a>.</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="running-the-code"></a><a href="#running-the-code" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running the code</h4>
<p>To get the application working we need to configure library's serial pins and baudrate. You can check default values in <code>rosserial-lib/mbed_lib.json</code>. If you use CORE2 with SBC connected to RPI connector, add this lines to your <code>mbed_app.json</code> file under <code>target_overrides.CORE2</code> object:</p>
<pre><code class="hljs css language-json">"rosserial-mbed.tx_pin": "RPI_SERIAL_TX",
"rosserial-mbed.rx_pin": "RPI_SERIAL_RX",
"rosserial-mbed.baudrate": "115200"
</code></pre>
<p>Your <code>mbed_app.json</code> file should look like this:</p>
<pre><code class="hljs css language-json">{
    <span class="hljs-attr">"config"</span>: {},
    <span class="hljs-attr">"macros"</span>: [],
    <span class="hljs-attr">"target_overrides"</span>: {
        <span class="hljs-attr">"CORE2"</span>: {
            <span class="hljs-attr">"events.shared-dispatch-from-application"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"platform.default-serial-baud-rate"</span>: <span class="hljs-number">115200</span>,
            <span class="hljs-attr">"platform.stdio-baud-rate"</span>: <span class="hljs-number">115200</span>,
            <span class="hljs-attr">"target.mbed_app_start"</span>: <span class="hljs-string">"0x08010000"</span>,
            <span class="hljs-attr">"rosserial-mbed.tx_pin"</span>: <span class="hljs-string">"RPI_SERIAL_TX"</span>,
            <span class="hljs-attr">"rosserial-mbed.rx_pin"</span>: <span class="hljs-string">"RPI_SERIAL_RX"</span>,
            <span class="hljs-attr">"rosserial-mbed.baudrate"</span>: <span class="hljs-string">"115200"</span>
        }
    }
}
</code></pre>
<p>Now you can compile the project and flash it to your board. To view communication on your SBC you must disable Husarion Cloud, which is not currently supported by our mbed template firmware. You can enable it at any moment.</p>
<p>In terminal type:</p>
<pre><code class="hljs css language-bash">    $ systemctl <span class="hljs-built_in">disable</span> husarnet-configurator
    $ sudo shutdown -r now <span class="hljs-comment"># it will reboot your SBC</span>
</code></pre>
<p>After reboot open terminal and in first tab run <code>roscore</code>. Press <code>CTRL + SHIFT + T</code> and in second tab run:</p>
<ul>
<li>Raspberry PI</li>
</ul>
<pre><code class="hljs css language-bash">    $ rosrun rosserial_python serial_node.py _port:=/dev/serial0 _baud:=115200
</code></pre>
<ul>
<li>Asus Tinker Board</li>
</ul>
<pre><code class="hljs css language-bash">    $ rosrun rosserial_python serial_node.py _port:=/dev/ttyS1 _baud:=115200
</code></pre>
<p>This will forward your MBED messages to rest of ROS.</p>
<p>To view communication on &quot;mbed_device&quot; topic open new termina and run:</p>
<pre><code class="hljs css language-bash">    $ rostopic <span class="hljs-built_in">echo</span> mbed_device
</code></pre>
<div>
<center><img src="./../../assets/img/mbed-tutorials/mbed-tutorial-img11.png" width="800px" alt=""/></center> 
</div> 
<h3><a class="anchor" aria-hidden="true" id="example-subscriber"></a><a href="#example-subscriber" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example subscriber</h3>
<p>In this project we'll use both publisher and subscriber as well as some cryptographic functionality of <a href="https://tls.mbed.org/">mbed TLS library</a> . Mbed TLS library include crypto and SSL/TLS capabilities with minimal footprint and easy to use API. It is available as part of Mbed OS.</p>
<p>Like in previous example create a new project and name it <code>subscriber-example</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="the-code-1"></a><a href="#the-code-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The code</h4>
<p>The example creates two topics - &quot;raw_input&quot; for user to send short String messages to be encrypted by <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES-ECB</a> block cipher and &quot;encrypted_output&quot; for user to collect encrypted messages.</p>
<pre><code class="hljs css language-cpp"><span class="hljs-comment">/*
 * main.cpp
 */</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;mbed.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Thread.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ros.h&gt; </span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;std_msgs/String.h&gt;</span></span>

<span class="hljs-comment">// header file for AES</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;mbedtls/aes.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BLOCK_SIZE 16</span>

<span class="hljs-comment">// LED1 = PE_2, </span>
<span class="hljs-comment">// LED2 = PE_3, </span>
<span class="hljs-comment">// LED3 = PE_4,</span>

<span class="hljs-comment">// Port masks</span>
<span class="hljs-keyword">enum</span> : <span class="hljs-keyword">uint8_t</span>{
    NONE = <span class="hljs-number">0</span>,
    L1 = <span class="hljs-number">0b00000100</span>,
    L2 = <span class="hljs-number">0b00001000</span>,
    L3 = <span class="hljs-number">0b00010000</span>,
    L1L2 = <span class="hljs-number">0b00001100</span>,
    ALL = <span class="hljs-number">0b00011100</span>
};

<span class="hljs-keyword">uint8_t</span> masks[] = {NONE,L1,L1L2,ALL};

<span class="hljs-comment">// Controls port E</span>
<span class="hljs-function">PortOut <span class="hljs-title">leds</span><span class="hljs-params">(PortE,ALL)</span></span>;

Thread ros_thread;
<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">bool</span> message_ready = <span class="hljs-literal">false</span>;

<span class="hljs-comment">// variables required for AES encryption ECB mode</span>
mbedtls_aes_context aes;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">uint8_t</span> secret_key[BLOCK_SIZE+<span class="hljs-number">1</span>] = <span class="hljs-string">"YMZE4oIxB9M14bkF"</span>; <span class="hljs-comment">// 128-bit key</span>
<span class="hljs-keyword">uint8_t</span> input[BLOCK_SIZE];
<span class="hljs-keyword">uint8_t</span> output[BLOCK_SIZE];
<span class="hljs-keyword">char</span> formatted_output[<span class="hljs-number">2</span>*BLOCK_SIZE+<span class="hljs-number">1</span>];

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-comment">// We use lambda style callback for registering a ros task</span>
    ros_thread.start([]() -&gt; <span class="hljs-keyword">void</span> {
        ros::NodeHandle nh;

        <span class="hljs-comment">// the output will be formated string of characters</span>
        std_msgs::String str_output;
        ros::Publisher pub(<span class="hljs-string">"output_encrypted"</span>, &amp;str_output);
        
        <span class="hljs-comment">// We instantiate publisher object with "input_raw" topic and attach lambda style </span>
        <span class="hljs-comment">// callback for subscriber event (when user sends something).</span>
        ros::Subscriber&lt;std_msgs::String&gt; sub(<span class="hljs-string">"input_raw"</span>, [](<span class="hljs-keyword">const</span> std_msgs::String&amp; raw)-&gt; <span class="hljs-keyword">void</span>{
            <span class="hljs-comment">// check if length &lt;= 16</span>
            <span class="hljs-keyword">int</span> n = <span class="hljs-built_in">strlen</span>(raw.data);
            <span class="hljs-keyword">if</span>(n == <span class="hljs-number">0</span> || n &gt; <span class="hljs-number">16</span>)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-built_in">memcpy</span>(input,raw.data,n);
            <span class="hljs-comment">// zero padding</span>
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = n; i&lt;BLOCK_SIZE; ++i)
                input[i] = <span class="hljs-number">0</span>;

            <span class="hljs-comment">// encrypt message     </span>
            mbedtls_aes_crypt_ecb(&amp;aes,MBEDTLS_AES_ENCRYPT,input,output);
            message_ready = <span class="hljs-literal">true</span>;
        });

        nh.initNode();
        nh.advertise(pub);
        
        <span class="hljs-comment">// subscribe to topic </span>
        nh.subscribe(sub);
        
        <span class="hljs-comment">// set aes key</span>
        mbedtls_aes_setkey_enc( &amp;aes, secret_key, <span class="hljs-number">128</span>);
        <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)
        {
            <span class="hljs-comment">// if message was encrypted send result to topic</span>
            <span class="hljs-keyword">if</span>(message_ready)
            {
                <span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>;
                <span class="hljs-comment">// format data </span>
                <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;BLOCK_SIZE;++i)
                {
                    <span class="hljs-built_in">sprintf</span>(formatted_output+j,<span class="hljs-string">"%02X"</span>,*(output+i));
                    j+=<span class="hljs-number">2</span>;
                }
                str_output.data = formatted_output;
                pub.publish(&amp;str_output);
                message_ready = <span class="hljs-literal">false</span>;
            }
            nh.spinOnce();
            ThisThread::sleep_for(<span class="hljs-number">50</span>);
        }
    });

    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, n = <span class="hljs-keyword">sizeof</span>(masks);
    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)
    {
        leds = masks[i%n];
        i++;
        ThisThread::sleep_for(<span class="hljs-number">500</span>);
    }
}
</code></pre>
<p>More about API used:</p>
<ul>
<li><a href="https://os.mbed.com/docs/v5.10/apis/portout.html">PortOut</a>,</li>
<li><a href="https://tls.mbed.org/api/aes_8h.html#a0e59fdda18a145e702984268b9ab291a">mbedtls_aes_crypt_ecb()</a>.</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="running-the-code-1"></a><a href="#running-the-code-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running the code</h4>
<p>On your SBC open a terminal and in separate tabs start <code>roscore</code> and <code>rosrun rosserial_python serial_node.py</code> bridge with the same parameters like in the previous example.</p>
<p>To receive encrypted messages, in a new tab run:</p>
<pre><code class="hljs css language-bash">    $ rostopic <span class="hljs-built_in">echo</span> output_encrypted
</code></pre>
<p>To publish new message to &quot;input_raw&quot; topic open a new tab and run:</p>
<pre><code class="hljs css language-bash">    $ rostopic pub std_msgs/String <span class="hljs-string">"Hello World!"</span> --once
</code></pre>
<div>
<center><img src="./../../assets/img/mbed-tutorials/mbed-tutorial-img12.png" width="800px" alt=""/></center> 
</div>
<p>If you want to learn more - check official <a href="http://wiki.ros.org/rosserial_mbed/Tutorials">rosserial mbed tutorials</a> from <strong>ros.org</strong>.</p>
<h4><a class="anchor" aria-hidden="true" id="tasks-1"></a><a href="#tasks-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tasks</h4>
<ul>
<li>Create an application that monitors the on-board button and publish the number of pushes to topic &quot;button&quot; every time the button's state changes. Use <a href="https://os.mbed.com/docs/v5.10/apis/interruptin.html">InterruptIn</a> object.</li>
<li>Create an application that lights up on-board leds accordingly to the mask value received on &quot;led_mask&quot; topic. Use <code>std_msgs::Uint8</code> type for ROS communication.</li>
</ul>
<!-- TODO: MOTOR SECTION -->
<h2><a class="anchor" aria-hidden="true" id="summary"></a><a href="#summary" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Summary</h2>
<p>After completing this tutorial you should know the basics of Mbed OS
components and tools. You should be able to create, compile and run mbed
applications on CORE2 and use Rosserial library to incorporate your mbed platform into ROS projects.</p>
<hr>
<p><em>by Szymon Szantula, Husarion</em></p>
<p><em>Do you need any support with completing this tutorial or have any difficulties with software or hardware? Feel free to describe your thoughts on our community forum: <a href="https://community.husarion.com/">https://community.husarion.com/</a> or to contact with our support: <a href="mailto:support@husarion.com">support@husarion.com</a></em></p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docusaurus-husarion-docs/doc2"><span class="arrow-prev">← </span><span>document number 2</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#introduction">Introduction</a></li><li><a href="#first-steps">First Steps</a><ul class="toc-headings"><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#mbed-cli-installation">mbed-cli installation</a></li><li><a href="#preparing-a-workspace">Preparing a workspace</a></li><li><a href="#template-project">Template Project</a></li></ul></li><li><a href="#rosserial-library">Rosserial library</a><ul class="toc-headings"><li><a href="#example-publisher">Example publisher</a></li><li><a href="#example-subscriber">Example subscriber</a></li></ul></li><li><a href="#summary">Summary</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/docusaurus-husarion-docs/" class="nav-home"><img src="/docusaurus-husarion-docs/img/husarion_logo_white.svg" alt="Husarion Docs" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docusaurus-husarion-docs/en/doc1.html">Getting Started (or other categories)</a><a href="/docusaurus-husarion-docs/en/doc2.html">Guides (or other categories)</a><a href="/docusaurus-husarion-docs/en/doc3.html">API Reference (or other categories)</a></div><div><h5>Community</h5><a href="/docusaurus-husarion-docs/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/docusaurus-husarion-docs/blog">Blog</a><a href="https://github.com/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2018 Husarion</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'my-api-key',
                indexName: 'my-index-name',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>