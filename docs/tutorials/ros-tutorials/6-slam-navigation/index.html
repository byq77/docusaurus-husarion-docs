<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>SLAM navigation · Husarion Docs</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;introduction&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#introduction&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Introduction&lt;/h2&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="SLAM navigation · Husarion Docs"/><meta property="og:type" content="website"/><meta property="og:url" content="https://byq77.github.io/docusaurus-husarion-docs/index.html"/><meta property="og:description" content="&lt;h2&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;introduction&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#introduction&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Introduction&lt;/h2&gt;
"/><meta property="og:image" content="https://byq77.github.io/docusaurus-husarion-docs/img/favicon.ico"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://byq77.github.io/docusaurus-husarion-docs/img/favicon.ico"/><link rel="shortcut icon" href="/docusaurus-husarion-docs/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.css"/><script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.6/dist/jquery.fancybox.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://byq77.github.io/docusaurus-husarion-docs/js/scrollspy.js"></script><script type="text/javascript" src="https://byq77.github.io/docusaurus-husarion-docs/js/sidebarScroll.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100,"diameter":56,"cornerOffset":20,"backgroundColor":"#d0112b","textColor":"#fff"}
          )
        });
        </script><link rel="stylesheet" href="/docusaurus-husarion-docs/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/docusaurus-husarion-docs/"><h2 class="headerTitle">Husarion Docs</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docusaurus-husarion-docs/docs/tutorials/" target="_self">Tutorials</a></li><li class=""><a href="/docusaurus-husarion-docs/docs/manuals/" target="_self">Manuals</a></li><li class=""><a href="/docusaurus-husarion-docs/docs/software/hframework" target="_self">Software</a></li><li class=""><a href="https://husarion.com/downloads/" target="_blank">Downloads</a></li><li class=""><a href="https://community.husarion.com/" target="_blank">Community</a></li><li class=""><a href="https://cloud.husarion.com/" target="_blank">Log In</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Tutorials</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorials</h3><ul><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/">About tutorials</a></li><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">How to start</h4><ul><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/howtostart/run-your-first-program">1. Run your first program</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/howtostart/video-streaming-from-a-camera">2. Video streaming</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/howtostart/getting-started-with-husarion--lego-mindstorms">3. Getting started with Husarion + LEGO Mindstorms</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/howtostart/telepresence-robot-kit---quick-start">4. Telepresence robot kit - quick start</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/howtostart/using-third-party-modules">5. Using third-party modules</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/howtostart/rosbot---quick-start">6. ROSbot - quick start</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">ROS tutorials</h4><ul><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/ros-tutorials/1-ros-introduction">1. ROS introduction</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/ros-tutorials/2-creating-nodes">2. Creating nodes</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/ros-tutorials/3-simple-kinematics-for-mobile-robot">3. Simple kinematics for mobile robot</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/ros-tutorials/4-visual-object-recognition">4. Visual object recognition</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/ros-tutorials/5-running-ros-on-multiple-machines">5. Running ROS on multiple machines</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/ros-tutorials/6-slam-navigation">6. SLAM navigation</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/ros-tutorials/7-path-planning">7. Path planning</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/ros-tutorials/8-unknown-environment-exploration">8. Unknown environment exploration</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/ros-tutorials/9-object-search">9. Object search</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Mbed tutorials</h4><ul><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/mbed-tutorials/using-core2-with-mbed-os">1. Using CORE2 with Mbed OS</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">Other tutorials</h4><ul><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/other-tutorials/hframework-library-development">1. hFramework library development</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/other-tutorials/offline-development-tools">2. Offline development tools</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/other-tutorials/how-to-use-core2-ros-local-serial-offline">3. How to use CORE2-ROS local serial offline</a></li><li class="navListItem"><a class="navItem" href="/docusaurus-husarion-docs/docs/tutorials/other-tutorials/run-ros-tutorials-using-aws-robomaker">4. Run ROS tutorials using AWS RoboMaker</a></li></ul></div></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">SLAM navigation</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="introduction"></a><a href="#introduction" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Introduction</h2>
<p>SLAM (simultaneous localization and mapping) is a technique for creating
a map of environment and determining robot position at the same time. It
is widely used in robotics.</p>
<p>While moving, current measurements and localization are changing, in
order to create map it is necessary to merge measurements from previous
positions.</p>
<p>For definition of SLAM problem we use given values (1,2) and expected values (3,4):</p>
<p>1.  Robot control </p>
    <table class="ros-tutorials">
    <tbody >
        <tr>
        <td width="100%"><i>u<sub>{1:t}</sub> = { u<sub>1</sub>, u<sub>2</sub>, u<sub>3</sub>, ..., u<sub>t</sub>}</i></td>
        <td width="60" >(1)</td>
        </tr>
    <tbody>
    </table>
<p>2.  Observations </p>
    <table class="ros-tutorials">
        <tr>
        <td width="100%"><i>z<sub>{1:t}</sub> = { z<sub>1</sub>, z<sub>2</sub>, z<sub>3</sub>, ..., z<sub>t</sub>}</i></td>
        <td width="60">(2)</td>
        </tr>
    </table>
<p>3.  Environment map</p>
    <table class="ros-tutorials">
        <tr>
        <td width="100%"><i>m</i></td>
        <td width="60">(3)</td>
        </tr>
    </table>
<p>4.  Robot trajectory</p>
    <table class="ros-tutorials">
        <tr>
        <td width="100%"><i>x<sub>{1:t}</sub> = { x<sub>1</sub>, x<sub>2</sub>, x<sub>3</sub>, ..., x<sub>t</sub>}</i></td>
        <td width="60">(4)</td>
        </tr>
    </table>
<p>6. Robot trajectory estimates are determined with:</p>
    <table class="ros-tutorials">
        <tr>
        <td width="100%"><i>p(x<sub>0:t</sub>,m|z<sub>1:t</sub>, u<sub>1:t</sub>)</i></td>
        <td width="60">(5)</td>
        </tr>
    </table>
<h2><a class="anchor" aria-hidden="true" id="coordinate-frames-tracking"></a><a href="#coordinate-frames-tracking" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Coordinate frames tracking</h2>
<p>ROS can help you with keeping track of coordinate frames over time.
Package for it is <code>tf2</code> - the transform library, it comes with a
specific message type: <code>tf/Transform</code> and it is always bound to one
topic: <code>/tf</code>. Message <code>tf/Transform</code> consist of transformation
(translation and rotation) between two coordinate frames, names of both
frames and timestamp. Publishing to <code>/tf</code> is done in different way than
to any other topic, we will write <code>tf</code> publisher in the example.</p>
<h3><a class="anchor" aria-hidden="true" id="publishing-transformation"></a><a href="#publishing-transformation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Publishing transformation</h3>
<p>We will make a node that subscribe to <code>/pose</code> topic with message type
<code>geometry_msgs/PoseStamped</code> and publish transformation between objects
mentioned in <code>/pose</code>. This node is required only on ROSbot, Gazebo is publishing necessary <code>tf</code> frames itself.</p>
<p>Begin with headers:</p>
<pre><code class="hljs css language-cpp">    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ros/ros.h&gt;</span></span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;geometry_msgs/PoseStamped.h&gt;</span></span>
    <span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;tf/transform_broadcaster.h&gt;</span></span>
</code></pre>
<p>Publisher for transformation:</p>
<pre><code class="hljs css language-cpp">    <span class="hljs-keyword">static</span> tf::TransformBroadcaster br;
</code></pre>
<p>Transformation message:</p>
<pre><code class="hljs css language-cpp">    tf::Transform transform;
</code></pre>
<p>Quaternion for storing rotation data:</p>
<pre><code class="hljs css language-cpp">    tf::Quaternion q;
</code></pre>
<p>Function for handling incoming <code>/PoseStamped</code> messages, extract
quaternion parameters from message and put it to quaternion structure,
put translation parameters into transform message, put quaternion
structure into transform message, publish transform:</p>
<pre><code class="hljs css language-cpp">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pose_callback</span><span class="hljs-params">(<span class="hljs-keyword">const</span> geometry_msgs::PoseStampedPtr &amp;pose)</span> </span>{
       q.setX(pose-&gt;pose.orientation.x);
       q.setY(pose-&gt;pose.orientation.y);
       q.setZ(pose-&gt;pose.orientation.z);
       q.setW(pose-&gt;pose.orientation.w);

       transform.setOrigin( tf::Vector3(pose-&gt;pose.position.x, pose-&gt;pose.position.y, <span class="hljs-number">0.0</span>) );
       transform.setRotation(q);

       br.sendTransform(tf::StampedTransform(transform, ros::Time::now(), <span class="hljs-string">"odom"</span>, <span class="hljs-string">"base_link"</span>));
    }
</code></pre>
<p>Publishing of transform is done with <code>sendTransform</code> function which
parameter is <code>StampedTransform</code> object. This object parameters are:</p>
<ul>
<li><p><code>transform</code> - transformation data</p></li>
<li><p><code>ros::Time::now()</code> - timestamp for current transformation</p></li>
<li><p><code>odom</code> - transformation parent frame - the one that is static</p></li>
<li><p><code>base_link</code> - transformation child frame - the one that is
transformed</p></li>
</ul>
<p>In main function just initialize node and subscribe to <code>/pose</code> topic:</p>
<pre><code class="hljs css language-cpp">    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span>{
       ros::init(argc, argv, <span class="hljs-string">"drive_controller"</span>);
       ros::<span class="hljs-function">NodeHandle <span class="hljs-title">n</span><span class="hljs-params">(<span class="hljs-string">"~"</span>)</span></span>;
       ros::Subscriber pose_sub = n.subscribe(<span class="hljs-string">"/pose"</span>, <span class="hljs-number">1</span>, pose_callback);
       ros::<span class="hljs-function">Rate <span class="hljs-title">loop_rate</span><span class="hljs-params">(<span class="hljs-number">100</span>)</span></span>;
       <span class="hljs-keyword">while</span> (ros::ok()) {
          ros::spinOnce();
          loop_rate.sleep();
       }
    }
</code></pre>
<p>Your final file should look like this:</p>
<pre><code class="hljs css language-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ros/ros.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;geometry_msgs/PoseStamped.h&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;tf/transform_broadcaster.h&gt;</span></span>


tf::Transform transform;
tf::Quaternion q;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pose_callback</span><span class="hljs-params">(<span class="hljs-keyword">const</span> geometry_msgs::PoseStampedPtr &amp;pose)</span>
</span>{
    <span class="hljs-keyword">static</span> tf::TransformBroadcaster br;
    q.setX(pose-&gt;pose.orientation.x);
    q.setY(pose-&gt;pose.orientation.y);
    q.setZ(pose-&gt;pose.orientation.z);
    q.setW(pose-&gt;pose.orientation.w);

    transform.setOrigin(tf::Vector3(pose-&gt;pose.position.x, pose-&gt;pose.position.y, <span class="hljs-number">0.0</span>));
    transform.setRotation(q);

    br.sendTransform(tf::StampedTransform(transform, ros::Time::now(), <span class="hljs-string">"odom"</span>, <span class="hljs-string">"base_link"</span>));
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span>
</span>{
    ros::init(argc, argv, <span class="hljs-string">"drive_controller"</span>);
    ros::<span class="hljs-function">NodeHandle <span class="hljs-title">n</span><span class="hljs-params">(<span class="hljs-string">"~"</span>)</span></span>;
    ros::Subscriber pose_sub = n.subscribe(<span class="hljs-string">"/pose"</span>, <span class="hljs-number">1</span>, pose_callback);
    ros::<span class="hljs-function">Rate <span class="hljs-title">loop_rate</span><span class="hljs-params">(<span class="hljs-number">100</span>)</span></span>;
    <span class="hljs-keyword">while</span> (ros::ok())
    {
        ros::spinOnce();
        loop_rate.sleep();
    }
}
</code></pre>
<p>Save it as <code>drive_controller.cpp</code>.</p>
<p>Now in <code>CMakeLists.txt</code> file find line:</p>
<pre><code class="hljs">find_package(catkin REQUIRED COMPONENTS
    roscpp
)
</code></pre>
<p>and change it to:</p>
<pre><code class="hljs">find_package(catkin REQUIRED COMPONENTS
    roscpp tf
)
</code></pre>
<p>then declare executable:</p>
<pre><code class="hljs">add_executable(drive_controller_node src/drive_controller.cpp)
</code></pre>
<p>And specify libraries to link:</p>
<pre><code class="hljs">target_link_libraries(drive_controller_node
        ${catkin_LIBRARIES}
        )
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="publisher-for-static-transformations"></a><a href="#publisher-for-static-transformations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Publisher for static transformations</h3>
<p>If we want to publish transformation which is not changing in time, we
can use <code>static_transform_publisher</code> from <code>tf</code> package. We will use it
for publishing relation between robot base and laser scanner.</p>
<p>We can run it from command line:</p>
<pre><code class="hljs">$ rosrun tf static_transform_publisher 0 0 0 3.14 0 0 base_link laser_frame 100
</code></pre>
<p>Arguments are consecutively:</p>
<ul>
<li><p><code>0 0 0</code> - x y z axes of translation, values are in meters</p></li>
<li><p><code>3.14 0 0</code> - z y x axes of rotation, values are in radians</p></li>
<li><p><code>base_link</code> - transformation parent frame - the one that is static</p></li>
<li><p><code>laser_frame</code> - transformation child frame - the one that is
transformed</p></li>
<li><p><code>100</code> - delay between consecutive messages</p></li>
</ul>
<p>You can use it to adjust position of your laser scanner relative to
robot. The best would be, if you place scanner in such a way that its
rotation axis is coaxial with robot rotation axis and front of laser
scanner base should face the same direction as robot front. Most
probably your laser scanner will be attached above robot base. To set
scanner 10 centimeters above robot you should use:</p>
<pre><code class="hljs">$ rosrun tf static_transform_publisher 0 0 0.1 0 0 0 base_link laser_frame 100
</code></pre>
<p>And if your scanner is also rotated by 180º around z-axis it should be:</p>
<pre><code class="hljs">$ rosrun tf static_transform_publisher 0 0 0.1 3.14 0 0 base_link laser_frame 100
</code></pre>
<p>Remember that if you have improperly mounted scanner or its position is
not set correctly, your map will be generated with errors or it will be
not generated at all.</p>
<h3><a class="anchor" aria-hidden="true" id="visualizing-transformation-with-rviz"></a><a href="#visualizing-transformation-with-rviz" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Visualizing transformation with rviz</h3>
<p>You can visualize all transformations that are published in the system.
To test it run:</p>
<ul>
<li><p><code>CORE2</code> bridge node -
<code>/opt/husarion/tools/rpi-linux/ros-core2-client /dev/ttyCORE2</code></p></li>
<li><p><code>drive_controller_node</code> - publisher that you just created</p></li>
</ul>
<p>Or instead ot these two start <code>Gazebo</code>:</p>
<ul>
<li><code>roslaunch rosbot_gazebo maze_world.launch</code></li>
</ul>
<p>You will also need <code>rviz</code> and keyboard controller:</p>
<ul>
<li><p><code>teleop_twist_keyboard</code> - keyboard controller</p></li>
<li><p><code>rviz</code> - visualization tool</p></li>
</ul>
<p>You may also add some <code>static_transform_publisher</code> nodes.</p>
<p>Now click <strong>Add</strong> from object manipulation buttons, in new window select
<strong><code>By display type</code></strong> and from the list select <code>Tf</code>. You can also add
<code>Pose</code> visualization. You can observe as <code>robot_base</code> frame moves
accordingly to robot movement.</p>
<p><img src="../../assets/img/ros/man_6_1.png" alt="image"></p>
<h2><a class="anchor" aria-hidden="true" id="slam-implementation-in-ros"></a><a href="#slam-implementation-in-ros" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SLAM implementation in ROS</h2>
<p>To perform accurate and precise SLAM, the best is to use laser scanner
and odometry system with high resolution encoders.</p>
<h3><a class="anchor" aria-hidden="true" id="running-the-laser-scanner"></a><a href="#running-the-laser-scanner" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running the laser scanner</h3>
<p>In this example we will use <strong><code>rpLidar</code></strong> laser scanner. Place it on
your robot, main rotation axis should pass the centre of robot. Front of
the <strong><code>rpLidar</code></strong> should face the same direction as front of the robot.</p>
<p>As a driver for the <strong><code>rpLidar</code></strong> we will use <code>rplidarNode</code> from
<code>rplidar_ros</code> package. This node communicate with device and publish its
scans to <code>/scan</code> topic with message type <code>sensor_msgs/LaserScan</code>. We do
not need more configuration for it now.</p>
<p>To test it you can run only this one node:</p>
<pre><code class="hljs css language-bash">    $ rosrun rplidar_ros rplidarNode
</code></pre>
<p>For <strong>Gazebo</strong> you do not need any additional nodes, just start simulator and laser scans will be already published to appropriate topic.</p>
<p>In case there are no scans showing, there may be a problem with laser scanner plugin for Gazebo. Some GPUs, mainly the integrated ones have problems with proper rendering of laser scanner. To solve it, you will have to change the used plugin to CPU based. Go to file <code>rosbot.gazebo</code> located in <code>rosbot_description/src/rosbot_description/urdf</code>, comment out section succeeding <code>&lt;!-- RpLidar using GPU --&gt;</code> line with <code>&lt;!--</code> to begin comment and <code>--&gt;</code> to end comment and uncomment section succeeding <code>&lt;!-- RpLidar using CPU --&gt;</code> line by deleting <code>&lt;!--</code> and <code>--&gt;</code>.</p>
<p>You should have <code>/scan</code> topic in your system. You can examine it with
<code>rostopic info</code> but better do not try to echo it, it is possible but you
will get lots of output that is hard to read. Better method for checking
the <code>/scan</code> topic is to use rviz. Run rviz and click <strong>Add</strong> from object
manipulation buttons, in new window select <strong><code>By topic</code></strong> and from the
list select <code>/scan</code>. In visualized items list find position
<code>Fixed Frame</code> and change it to <code>laser_frame</code>. To improve visibility of
scanned shape, you may need to adjust one of visualized object options,
set value of <code>Style</code> to <code>Points</code>. You should see many points which
resemble shape of obstacles surrounding your robot.</p>
<p><img src="../../assets/img/ros/man_6_2.png" alt="image"></p>
<p>Shut down <code>rplidarNode</code> and run it again, but with some other nodes:</p>
<ul>
<li><p><code>CORE2</code> bridge node -
<code>/opt/husarion/tools/rpi-linux/ros-core2-client /dev/ttyCORE2</code></p></li>
<li><p><code>rplidarNode</code> - driver for rpLidar laser scanner</p></li>
<li><p><code>drive_controller_node</code> - publisher that you just created</p></li>
</ul>
<p>Or instead of these three, start <code>Gazebo</code>:</p>
<ul>
<li><code>roslaunch rosbot_gazebo maze_world.launch</code></li>
</ul>
<p>You will also need:</p>
<ul>
<li><p><code>static_transform_publisher</code> - <code>tf</code> publisher for transformation of
laser scanner relative to robot</p></li>
<li><p><code>teleop_twist_keyboard</code> - keyboard controller</p></li>
</ul>
<ul>
<li><code>rviz</code> - visualization tool</li>
</ul>
<p>You can use below <code>launch</code> file:</p>
<pre><code class="hljs">&lt;launch&gt;

    &lt;arg <span class="hljs-type">name</span>="use_rosbot" default="true"/&gt;
    &lt;arg <span class="hljs-type">name</span>="use_gazebo" default="false"/&gt;

    &lt;<span class="hljs-keyword">include</span> <span class="hljs-keyword">if</span>="$(arg use_gazebo)" file="$(find rosbot_gazebo)/launch/maze_world.launch"/&gt;
    &lt;<span class="hljs-keyword">include</span> <span class="hljs-keyword">if</span>="$(arg use_gazebo)" file="$(find rosbot_gazebo)/launch/rosbot.launch"/&gt;

    &lt;node <span class="hljs-keyword">if</span>="$(arg use_rosbot)" pkg="rplidar_ros" <span class="hljs-keyword">type</span>="rplidarNode" <span class="hljs-type">name</span>="rplidar"&gt;
        &lt;param <span class="hljs-type">name</span>="angle_compensate" <span class="hljs-keyword">type</span>="bool" <span class="hljs-keyword">value</span>="true"/&gt;
    &lt;/node&gt;
    
    &lt;node <span class="hljs-keyword">if</span>="$(arg use_rosbot)" pkg="tutorial_pkg" <span class="hljs-keyword">type</span>="drive_controller_node" <span class="hljs-type">name</span>="drive_controller"/&gt;

    &lt;node pkg="tf" <span class="hljs-keyword">type</span>="static_transform_publisher" <span class="hljs-type">name</span>="laser_broadcaster" args="0 0 0 3.14 0 0 base_link laser_frame 100" /&gt;

    &lt;node pkg="teleop_twist_keyboard" <span class="hljs-keyword">type</span>="teleop_twist_keyboard.py" <span class="hljs-type">name</span>="teleop_twist_keyboard" output="screen"/&gt;

    &lt;node pkg="rviz" <span class="hljs-keyword">type</span>="rviz" <span class="hljs-type">name</span>="rviz"/&gt;

&lt;/launch&gt;
</code></pre>
<p>In <code>rviz</code> add <code>Tf</code> and <code>/scan</code>. This time set <code>Fixed Frame</code> to <code>odom</code>.</p>
<p>Try to move around your robot, you should see as laser scans change its
shape accordingly to obstacles passed by robot.</p>
<p><img src="../../assets/img/ros/man_6_3.png" alt="image"></p>
<h3><a class="anchor" aria-hidden="true" id="navigation-and-map-building"></a><a href="#navigation-and-map-building" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Navigation and map building</h3>
<p>For building a map and localizing robot relative to it, we will use
<code>slam_gmapping</code> node from <code>gmapping</code> package.</p>
<p>This node subscribes <code>/tf</code> topic to obtain robot pose relative to
starting point and laser scanner pose relative to robot and also
subscribe <code>/scan</code> topic to obtain laser scanner messages. Node publishes
to <code>/map</code> topic with message type <code>nav_msgs/OccupancyGrid</code>, this contain
the actual map data.</p>
<p>We need to set few parameters:</p>
<ul>
<li><p><code>base_frame</code> - name of frame related with robot, in our case it will
be <code>base_link</code></p></li>
<li><p><code>odom_frame</code> - name of frame related with starting point, in our
case it will be <code>odom</code></p></li>
<li><p><code>delta</code> - map resolution expressed as size of every pixel in meters</p></li>
</ul>
<p>You can use below <code>launch</code> file:</p>
<pre><code class="hljs">&lt;launch&gt;

    &lt;arg <span class="hljs-type">name</span>="use_rosbot" default="true"/&gt;
    &lt;arg <span class="hljs-type">name</span>="use_gazebo" default="false"/&gt;

    &lt;<span class="hljs-keyword">include</span> <span class="hljs-keyword">if</span>="$(arg use_gazebo)" file="$(find rosbot_gazebo)/launch/maze_world.launch"/&gt;
    &lt;<span class="hljs-keyword">include</span> <span class="hljs-keyword">if</span>="$(arg use_gazebo)" file="$(find rosbot_gazebo)/launch/rosbot.launch"/&gt;

    &lt;node <span class="hljs-keyword">if</span>="$(arg use_rosbot)" pkg="rplidar_ros" <span class="hljs-keyword">type</span>="rplidarNode" <span class="hljs-type">name</span>="rplidar"&gt;
        &lt;param <span class="hljs-type">name</span>="angle_compensate" <span class="hljs-keyword">type</span>="bool" <span class="hljs-keyword">value</span>="true"/&gt;
    &lt;/node&gt;
    
    &lt;node <span class="hljs-keyword">if</span>="$(arg use_rosbot)" pkg="tutorial_pkg" <span class="hljs-keyword">type</span>="drive_controller_node" <span class="hljs-type">name</span>="drive_controller"/&gt;

    &lt;node pkg="tf" <span class="hljs-keyword">type</span>="static_transform_publisher" <span class="hljs-type">name</span>="laser_broadcaster" args="0 0 0 3.14 0 0 base_link laser_frame 100" /&gt;

    &lt;node pkg="teleop_twist_keyboard" <span class="hljs-keyword">type</span>="teleop_twist_keyboard.py" <span class="hljs-type">name</span>="teleop_twist_keyboard" output="screen"/&gt;

    &lt;node pkg="rviz" <span class="hljs-keyword">type</span>="rviz" <span class="hljs-type">name</span>="rviz"/&gt;

    &lt;node pkg="gmapping" <span class="hljs-keyword">type</span>="slam_gmapping" <span class="hljs-type">name</span>="gmapping"&gt;
        &lt;param <span class="hljs-type">name</span>="base_frame" <span class="hljs-keyword">value</span>="base_link"/&gt;
        &lt;param <span class="hljs-type">name</span>="odom_frame" <span class="hljs-keyword">value</span>="odom" /&gt;
        &lt;param <span class="hljs-type">name</span>="delta" <span class="hljs-keyword">value</span>="0.1" /&gt;
    &lt;/node&gt;

&lt;/launch&gt;
</code></pre>
<p>In <code>rviz</code> add <code>Tf</code> and <code>/scan</code>, again open object adding window, select
<strong><code>By topic</code></strong> and from the list select <code>/map</code>.</p>
<p>At the beginning there could be no map, you may need to wait few second
until it is generated. Starting state should be similar to the one on
picture:</p>
<p><img src="../../assets/img/ros/man_6_4.png" alt="image"></p>
<p>Now drive your robot around and observe as new parts of map are added,
continue until all places are explored. Final map should look like
below:</p>
<p><img src="../../assets/img/ros/man_6_5.png" alt="image"></p>
<h2><a class="anchor" aria-hidden="true" id="summary"></a><a href="#summary" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Summary</h2>
<p>After completing this tutorial you should be able to publish
transformations between various frames, connect laser scanner to the
system, set up <code>slam_gmapping</code> node to perform SLAM task and visualize
map, robot position and all related frames.</p>
<hr>
<p><em>by Łukasz Mitka, Husarion</em></p>
<p><em>Do you need any support with completing this tutorial or have any difficulties with software or hardware? Feel free to describe your thoughts on our community forum: <a href="https://community.husarion.com/">https://community.husarion.com/</a> or to contact with our support: <a href="mailto:support@husarion.com">support@husarion.com</a></em></p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docusaurus-husarion-docs/docs/tutorials/ros-tutorials/5-running-ros-on-multiple-machines"><span class="arrow-prev">← </span><span>5. Running ROS on multiple machines</span></a><a class="docs-next button" href="/docusaurus-husarion-docs/docs/tutorials/ros-tutorials/7-path-planning"><span>7. Path planning</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#introduction">Introduction</a></li><li><a href="#coordinate-frames-tracking">Coordinate frames tracking</a><ul class="toc-headings"><li><a href="#publishing-transformation">Publishing transformation</a></li><li><a href="#publisher-for-static-transformations">Publisher for static transformations</a></li><li><a href="#visualizing-transformation-with-rviz">Visualizing transformation with rviz</a></li></ul></li><li><a href="#slam-implementation-in-ros">SLAM implementation in ROS</a><ul class="toc-headings"><li><a href="#running-the-laser-scanner">Running the laser scanner</a></li><li><a href="#navigation-and-map-building">Navigation and map building</a></li></ul></li><li><a href="#summary">Summary</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/docusaurus-husarion-docs/" class="nav-home"></a><div><h5>Company</h5><a href="https://husarion.com/about.html" target="_blank" rel="noreferrer noopener">About Us</a><a href="https://husarion.com/contact.html" target="_blank" rel="noreferrer noopener">Contact</a><a href="https://medium.com/husarion-blog" target="_blank" rel="noreferrer noopener">Blog</a><a href="https://cloud.husarion.com/tos" target="_blank" rel="noreferrer noopener">Terms of service</a></div><div><h5>Developers</h5><a href="#" target="_blank" rel="noreferrer noopener">Documentation</a><a href="https://cloud.husarion.com/" target="_blank" rel="noreferrer noopener">Husarion Cloud</a><a href="https://community.husarion.com/" target="_blank" rel="noreferrer noopener">Community forum</a><a href="https://husarion.com/downloads/" target="_blank" rel="noreferrer noopener">Downloads</a><a href="https://husarion.com" target="_blank" rel="noreferrer noopener">Home Page</a></div><div><h5>Social</h5><a href="https://www.facebook.com/husarionTechnology/" target="_blank" rel="noreferrer noopener">Facebook</a><a href="https://twitter.com/husarion" target="_blank" rel="noreferrer noopener">Twitter</a><a href="https://github.com/husarion" target="_blank" rel="noreferrer noopener">GitHub</a></div></section><section class="copyright">Copyright © 2018 Husarion sp. z o.o.</section></footer></div></body></html>